<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PingFang SC:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhangruochi.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="RUOCHI.AI">
<meta property="og:url" content="https://zhangruochi.com/page/8/index.html">
<meta property="og:site_name" content="RUOCHI.AI">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Ruochi Zhang">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://zhangruochi.com/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>RUOCHI.AI</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">RUOCHI.AI</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

      
    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/Fucking-distributions/2020/03/22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Fucking-distributions/2020/03/22/" class="post-title-link" itemprop="url">Fucking distributions</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-03-22 03:44:30 / Modified: 15:50:53" itemprop="dateCreated datePublished" datetime="2020-03-22T03:44:30+08:00">2020-03-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Math/" itemprop="url" rel="index"><span itemprop="name">Math</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Math/Statistics/" itemprop="url" rel="index"><span itemprop="name">Statistics</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/Fucking-distributions/2020/03/22/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Fucking-distributions/2020/03/22/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Understanding distributions</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/Fucking-distributions/2020/03/22/">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/Gaussian-Mixed-Model-Introduction/2020/03/15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Gaussian-Mixed-Model-Introduction/2020/03/15/" class="post-title-link" itemprop="url">Gaussian Mixed Model Introduction</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-03-15 00:44:46 / Modified: 15:08:58" itemprop="dateCreated datePublished" datetime="2020-03-15T00:44:46+08:00">2020-03-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/" itemprop="url" rel="index"><span itemprop="name">Artificial Intelligence</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/Machine-Learning/" itemprop="url" rel="index"><span itemprop="name">Machine Learning</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/Gaussian-Mixed-Model-Introduction/2020/03/15/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Gaussian-Mixed-Model-Introduction/2020/03/15/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Gaussian Mixture Models Introduction</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/Gaussian-Mixed-Model-Introduction/2020/03/15/">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/Lifelong-Learning/2020/03/14/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Lifelong-Learning/2020/03/14/" class="post-title-link" itemprop="url">Lifelong Learning</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-14 02:28:06" itemprop="dateCreated datePublished" datetime="2020-03-14T02:28:06+08:00">2020-03-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-12-31 15:44:04" itemprop="dateModified" datetime="2021-12-31T15:44:04+08:00">2021-12-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/" itemprop="url" rel="index"><span itemprop="name">Artificial Intelligence</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/Lifelong-Learning/2020/03/14/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Lifelong-Learning/2020/03/14/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Lifelong Learning</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/Lifelong-Learning/2020/03/14/">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/Object-Detection-Summary/2020/03/06/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Object-Detection-Summary/2020/03/06/" class="post-title-link" itemprop="url">Object Detection Summary</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-06 15:53:08" itemprop="dateCreated datePublished" datetime="2020-03-06T15:53:08+08:00">2020-03-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-12-31 15:40:44" itemprop="dateModified" datetime="2021-12-31T15:40:44+08:00">2021-12-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/" itemprop="url" rel="index"><span itemprop="name">Artificial Intelligence</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/Object-Detection-Summary/2020/03/06/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Object-Detection-Summary/2020/03/06/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Object Detection Summary</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/Object-Detection-Summary/2020/03/06/">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/AI-Search-II/2020/03/05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/AI-Search-II/2020/03/05/" class="post-title-link" itemprop="url">AI - Search II</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-05 11:44:39" itemprop="dateCreated datePublished" datetime="2020-03-05T11:44:39+08:00">2020-03-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-12-31 15:10:45" itemprop="dateModified" datetime="2021-12-31T15:10:45+08:00">2021-12-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/" itemprop="url" rel="index"><span itemprop="name">Artificial Intelligence</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/AI-Search-II/2020/03/05/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/AI-Search-II/2020/03/05/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>CS221 course notes of Search problem in AI</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/AI-Search-II/2020/03/05/">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/Programming-Language-Summary/2020/02/27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Programming-Language-Summary/2020/02/27/" class="post-title-link" itemprop="url">Programming Language: Summary</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-27 16:51:07" itemprop="dateCreated datePublished" datetime="2020-02-27T16:51:07+08:00">2020-02-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-12-31 15:38:17" itemprop="dateModified" datetime="2021-12-31T15:38:17+08:00">2021-12-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Programming-Language/" itemprop="url" rel="index"><span itemprop="name">Programming Language</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/Programming-Language-Summary/2020/02/27/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Programming-Language-Summary/2020/02/27/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Programming Language</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/Programming-Language-Summary/2020/02/27/">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/TensorBoard/2020/02/22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/TensorBoard/2020/02/22/" class="post-title-link" itemprop="url">TensorBoard</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-22 13:34:48" itemprop="dateCreated datePublished" datetime="2020-02-22T13:34:48+08:00">2020-02-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-14 07:23:53" itemprop="dateModified" datetime="2020-04-14T07:23:53+08:00">2020-04-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI-Workflow/" itemprop="url" rel="index"><span itemprop="name">AI Workflow</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI-Workflow/Visualization/" itemprop="url" rel="index"><span itemprop="name">Visualization</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/TensorBoard/2020/02/22/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/TensorBoard/2020/02/22/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="tensorboard-with-fashion-mnist">TensorBoard with Fashion MNIST</h1>
<p>In this week's exercise you will train a convolutional neural network to classify images of the Fashion MNIST dataset and you will use TensorBoard to explore how it's confusion matrix evolves over time.</p>
<h2 id="setup">Setup</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load the TensorBoard notebook extension.</span></span><br><span class="line">%load_ext tensorboard</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> sklearn.metrics</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> getcwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;TensorFlow version: &quot;</span>, tf.__version__)</span><br></pre></td></tr></table></figure>
<pre><code>TensorFlow version:  2.0.0</code></pre>
<h2 id="load-the-fashion-mnist-dataset">Load the Fashion-MNIST Dataset</h2>
<p>We are going to use a CNN to classify images in the the <a target="_blank" rel="noopener" href="https://research.zalando.com/welcome/mission/research-projects/fashion-mnist/">Fashion-MNIST</a> dataset. This dataset consist of 70,000 grayscale images of fashion products from 10 categories, with 7,000 images per category. The images have a size of <span class="math inline">\(28\times28\)</span> pixels.</p>
<p>First, we load the data. Even though these are really images, we will load them as NumPy arrays and not as binary image objects. The data is already divided into training and testing sets.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load the data.</span></span><br><span class="line">train_images = np.load(<span class="string">f&quot;<span class="subst">&#123;getcwd()&#125;</span>/../tmp2/train_images.npy&quot;</span>)</span><br><span class="line">train_labels = np.load(<span class="string">f&quot;<span class="subst">&#123;getcwd()&#125;</span>/../tmp2/train_labels.npy&quot;</span>)</span><br><span class="line"></span><br><span class="line">test_images = np.load(<span class="string">f&quot;<span class="subst">&#123;getcwd()&#125;</span>/../tmp2/test_images.npy&quot;</span>)</span><br><span class="line">test_labels = np.load(<span class="string">f&quot;<span class="subst">&#123;getcwd()&#125;</span>/../tmp2/test_labels.npy&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The labels of the images are integers representing classes.</span></span><br><span class="line"><span class="comment"># Here we set the Names of the integer classes, i.e., 0 -&gt; T-short/top, 1 -&gt; Trouser, etc.</span></span><br><span class="line">class_names = [<span class="string">&#x27;T-shirt/top&#x27;</span>, <span class="string">&#x27;Trouser&#x27;</span>, <span class="string">&#x27;Pullover&#x27;</span>, <span class="string">&#x27;Dress&#x27;</span>, <span class="string">&#x27;Coat&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;Sandal&#x27;</span>, <span class="string">&#x27;Shirt&#x27;</span>, <span class="string">&#x27;Sneaker&#x27;</span>, <span class="string">&#x27;Bag&#x27;</span>, <span class="string">&#x27;Ankle boot&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h2 id="format-the-images">Format the Images</h2>
<p><code>train_images</code> is a NumPy array with shape <code>(60000, 28, 28)</code> and <code>test_images</code> is a NumPy array with shape <code>(10000, 28, 28)</code>. However, our model expects arrays with shape <code>(batch_size, height, width, channels)</code> . Therefore, we must reshape our NumPy arrays to also include the number of color channels. Since the images are grayscale, we will set <code>channels</code> to <code>1</code>. We will also normalize the values of our NumPy arrays to be in the range <code>[0,1]</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Pre-process images</span></span><br><span class="line">train_images = train_images.reshape(<span class="number">60000</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)</span><br><span class="line">train_images = train_images / <span class="number">255.0</span></span><br><span class="line"></span><br><span class="line">test_images = test_images.reshape(<span class="number">10000</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)</span><br><span class="line">test_images = test_images / <span class="number">255.0</span></span><br></pre></td></tr></table></figure>
<h2 id="build-the-model">Build the Model</h2>
<p>We will build a simple CNN and compile it.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Build the model</span></span><br><span class="line">model = tf.keras.models.Sequential([</span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)),</span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>, <span class="number">2</span>),</span><br><span class="line">    tf.keras.layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>,<span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>),</span><br><span class="line">    tf.keras.layers.MaxPooling2D(<span class="number">2</span>,<span class="number">2</span>),</span><br><span class="line">    tf.keras.layers.Flatten(),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">128</span>, activation=<span class="string">&#x27;relu&#x27;</span>),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;adam&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;sparse_categorical_crossentropy&#x27;</span>,</span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure>
<h2 id="plot-confusion-matrix">Plot Confusion Matrix</h2>
<p>When training a classifier, it's often useful to see the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Confusion_matrix">confusion matrix</a>. The confusion matrix gives you detailed knowledge of how your classifier is performing on test data.</p>
<p>In the cell below, we will define a function that returns a Matplotlib figure containing the plotted confusion matrix.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_confusion_matrix</span>(<span class="params">cm, class_names</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Returns a matplotlib figure containing the plotted confusion matrix.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">       cm (array, shape = [n, n]): a confusion matrix of integer classes</span></span><br><span class="line"><span class="string">       class_names (array, shape = [n]): String names of the integer classes</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    figure = plt.figure(figsize=(<span class="number">8</span>, <span class="number">8</span>))</span><br><span class="line">    plt.imshow(cm, interpolation=<span class="string">&#x27;nearest&#x27;</span>, cmap=plt.cm.Blues)</span><br><span class="line">    plt.title(<span class="string">&quot;Confusion matrix&quot;</span>)</span><br><span class="line">    plt.colorbar()</span><br><span class="line">    tick_marks = np.arange(<span class="built_in">len</span>(class_names))</span><br><span class="line">    plt.xticks(tick_marks, class_names, rotation=<span class="number">45</span>)</span><br><span class="line">    plt.yticks(tick_marks, class_names)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Normalize the confusion matrix.</span></span><br><span class="line">    cm = np.around(cm.astype(<span class="string">&#x27;float&#x27;</span>) / cm.<span class="built_in">sum</span>(axis=<span class="number">1</span>)[:, np.newaxis], decimals=<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Use white text if squares are dark; otherwise black.</span></span><br><span class="line">    threshold = cm.<span class="built_in">max</span>() / <span class="number">2.</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, j <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(cm.shape[<span class="number">0</span>]), <span class="built_in">range</span>(cm.shape[<span class="number">1</span>])):</span><br><span class="line">        color = <span class="string">&quot;white&quot;</span> <span class="keyword">if</span> cm[i, j] &gt; threshold <span class="keyword">else</span> <span class="string">&quot;black&quot;</span></span><br><span class="line">        plt.text(j, i, cm[i, j], horizontalalignment=<span class="string">&quot;center&quot;</span>, color=color)</span><br><span class="line">        </span><br><span class="line">    plt.tight_layout()</span><br><span class="line">    plt.ylabel(<span class="string">&#x27;True label&#x27;</span>)</span><br><span class="line">    plt.xlabel(<span class="string">&#x27;Predicted label&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> figure</span><br></pre></td></tr></table></figure>
<h2 id="tensorboard-callback">TensorBoard Callback</h2>
<p>We are now ready to train the CNN and regularly log the confusion matrix during the process. In the cell below, you will create a <a target="_blank" rel="noopener" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks/TensorBoard">Keras TensorBoard callback</a> to log basic metrics.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Clear logs prior to logging data.</span></span><br><span class="line">!rm -rf logs/image</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create log directory</span></span><br><span class="line">logdir = <span class="string">&quot;logs/image/&quot;</span> + datetime.now().strftime(<span class="string">&quot;%Y%m%d-%H%M%S&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># EXERCISE: Define a TensorBoard callback. Use the log_dir parameter</span></span><br><span class="line"><span class="comment"># to specify the path to the directory where you want to save the</span></span><br><span class="line"><span class="comment"># log files to be parsed by TensorBoard.</span></span><br><span class="line">tensorboard_callback = keras.callbacks.TensorBoard(log_dir = logdir, histogram_freq = <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">file_writer_cm = tf.summary.create_file_writer(logdir + <span class="string">&#x27;/cm&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>rm: cannot remove &#39;logs/image/20200222-182126/cm&#39;: Directory not empty</code></pre>
<h2 id="convert-matplotlib-figure-to-png">Convert Matplotlib Figure to PNG</h2>
<p>Unfortunately, the Matplotlib file format cannot be logged as an image, but the PNG file format can be logged. So, you will create a helper function that takes a Matplotlib figure and converts it to PNG format so it can be written.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_to_image</span>(<span class="params">figure</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Converts the matplotlib plot specified by &#x27;figure&#x27; to a PNG image and</span></span><br><span class="line"><span class="string">    returns it. The supplied figure is closed and inaccessible after this call.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    buf = io.BytesIO()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># EXERCISE: Use plt.savefig to save the plot to a PNG in memory.</span></span><br><span class="line">    <span class="comment"># YOUR CODE HERE</span></span><br><span class="line">    plt.savefig(buf, <span class="built_in">format</span>=<span class="string">&#x27;png&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Closing the figure prevents it from being displayed directly inside</span></span><br><span class="line">    <span class="comment"># the notebook.</span></span><br><span class="line">    plt.close(figure)</span><br><span class="line">    buf.seek(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># EXERCISE: Use tf.image.decode_png to convert the PNG buffer</span></span><br><span class="line">    <span class="comment"># to a TF image. Make sure you use 4 channels.</span></span><br><span class="line">    image = tf.image.decode_png(buf.getvalue(), channels=<span class="number">4</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># EXERCISE: Use tf.expand_dims to add the batch dimension</span></span><br><span class="line">    image = tf.expand_dims(image, <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> image</span><br></pre></td></tr></table></figure>
<h2 id="confusion-matrix">Confusion Matrix</h2>
<p>In the cell below, you will define a function that calculates the confusion matrix.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_confusion_matrix</span>(<span class="params">epoch, logs</span>):</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># EXERCISE: Use the model to predict the values from the test_images.</span></span><br><span class="line">    test_pred_raw = model.predict(test_images)    </span><br><span class="line">    test_pred = np.argmax(test_pred_raw, axis=<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># EXERCISE: Calculate the confusion matrix using sklearn.metrics</span></span><br><span class="line">    cm = sklearn.metrics.confusion_matrix(test_labels, test_pred)</span><br><span class="line">    </span><br><span class="line">    figure = plot_confusion_matrix(cm, class_names=class_names)</span><br><span class="line">    cm_image = plot_to_image(figure)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Log the confusion matrix as an image summary.</span></span><br><span class="line">    <span class="keyword">with</span> file_writer_cm.as_default():</span><br><span class="line">        tf.summary.image(<span class="string">&quot;Confusion Matrix&quot;</span>, cm_image, step=epoch)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the per-epoch callback.</span></span><br><span class="line">cm_callback = keras.callbacks.LambdaCallback(on_epoch_end=log_confusion_matrix)</span><br></pre></td></tr></table></figure>
<h2 id="running-tensorboard">Running TensorBoard</h2>
<p>The next step will be to run the code shown below to render the TensorBoard. Unfortunately, TensorBoard cannot be rendered within the Coursera environment. Therefore, we won't run the code below.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Start TensorBoard.</span></span><br><span class="line">%tensorboard --logdir logs/image</span><br><span class="line"></span><br><span class="line"><span class="comment"># Train the classifier.</span></span><br><span class="line">model.fit(train_images,</span><br><span class="line">          train_labels,</span><br><span class="line">          epochs=<span class="number">5</span>,</span><br><span class="line">          verbose=<span class="number">0</span>, <span class="comment"># Suppress chatty output</span></span><br><span class="line">          callbacks=[tensorboard_callback, cm_callback],</span><br><span class="line">          validation_data=(test_images, test_labels))</span><br></pre></td></tr></table></figure>
<p>However, you are welcome to download the notebook and run the above code locally on your machine or in Google's Colab to see TensorBoard in action. Below are some example screenshots that you should see when executing the code:</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/Tensorflow-hub/2020/02/22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Tensorflow-hub/2020/02/22/" class="post-title-link" itemprop="url">Tensorflow hub</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-22 02:48:22" itemprop="dateCreated datePublished" datetime="2020-02-22T02:48:22+08:00">2020-02-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-08 02:05:24" itemprop="dateModified" datetime="2020-04-08T02:05:24+08:00">2020-04-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/" itemprop="url" rel="index"><span itemprop="name">Artificial Intelligence</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI-Workflow/" itemprop="url" rel="index"><span itemprop="name">AI Workflow</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI-Workflow/Deployment/" itemprop="url" rel="index"><span itemprop="name">Deployment</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/Tensorflow-hub/2020/02/22/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Tensorflow-hub/2020/02/22/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="exporting-an-mnist-classifier-in-savedmodel-format">Exporting an MNIST Classifier in SavedModel Format</h1>
<p>In this exercise, we will learn on how to create models for TensorFlow Hub. You will be tasked with performing the following tasks:</p>
<ul>
<li>Creating a simple MNIST classifier and evaluating its accuracy.</li>
<li>Exporting it into SavedModel.</li>
<li>Hosting the model as TF Hub Module.</li>
<li>Importing this TF Hub Module to be used with Keras Layers.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> tensorflow_hub <span class="keyword">as</span> hub</span><br><span class="line"><span class="keyword">import</span> tensorflow_datasets <span class="keyword">as</span> tfds</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> getcwd</span><br></pre></td></tr></table></figure>
<h2 id="create-an-mnist-classifier">Create an MNIST Classifier</h2>
<p>We will start by creating a class called <code>MNIST</code>. This class will load the MNIST dataset, preprocess the images from the dataset, and build a CNN based classifier. This class will also have some methods to train, test, and save our model.</p>
<p>In the cell below, fill in the missing code and create the following Keras <code>Sequential</code> model:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Model: &quot;sequential&quot;</span><br><span class="line">_________________________________________________________________</span><br><span class="line">Layer (type)                 Output Shape              Param #   </span><br><span class="line">=================================================================</span><br><span class="line">lambda (Lambda)              (None, 28, 28, 1)         0         </span><br><span class="line">_________________________________________________________________</span><br><span class="line">conv2d (Conv2D)              (None, 28, 28, 8)         80        </span><br><span class="line">_________________________________________________________________</span><br><span class="line">max_pooling2d (MaxPooling2D) (None, 14, 14, 8)         0         </span><br><span class="line">_________________________________________________________________</span><br><span class="line">conv2d_1 (Conv2D)            (None, 14, 14, 16)        1168      </span><br><span class="line">_________________________________________________________________</span><br><span class="line">max_pooling2d_1 (MaxPooling2 (None, 7, 7, 16)          0         </span><br><span class="line">_________________________________________________________________</span><br><span class="line">conv2d_2 (Conv2D)            (None, 7, 7, 32)          4640      </span><br><span class="line">_________________________________________________________________</span><br><span class="line">flatten (Flatten)            (None, 1568)              0         </span><br><span class="line">_________________________________________________________________</span><br><span class="line">dense (Dense)                (None, 128)               200832    </span><br><span class="line">_________________________________________________________________</span><br><span class="line">dense_1 (Dense)              (None, 10)                1290      </span><br><span class="line">=================================================================</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Notice that we are using a <code>tf.keras.layers.Lambda</code> layer at the beginning of our model. <code>Lambda</code> layers are used to wrap arbitrary expressions as a <code>Layer</code> object:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.keras.layers.Lambda(expression)</span><br></pre></td></tr></table></figure>
<p>The <code>Lambda</code> layer exists so that arbitrary TensorFlow functions can be used when constructing <code>Sequential</code> and Functional API models. <code>Lambda</code> layers are best suited for simple operations.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MNIST</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, export_path, buffer_size=<span class="number">1000</span>, batch_size=<span class="number">32</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                 learning_rate=<span class="number">1e-3</span>, epochs=<span class="number">10</span></span>):</span></span><br><span class="line">        self._export_path = export_path</span><br><span class="line">        self._buffer_size = buffer_size</span><br><span class="line">        self._batch_size = batch_size</span><br><span class="line">        self._learning_rate = learning_rate</span><br><span class="line">        self._epochs = epochs</span><br><span class="line">    </span><br><span class="line">        self._build_model()</span><br><span class="line">        self.train_dataset, self.test_dataset = self._prepare_dataset()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Function to preprocess the images.</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">preprocess_fn</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># EXERCISE: Cast x to tf.float32 using the tf.cast() function.</span></span><br><span class="line">        <span class="comment"># You should also normalize the values of x to be in the range [0, 1].</span></span><br><span class="line">        x = tf.cast(x, tf.float32) / <span class="number">255.0</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_build_model</span>(<span class="params">self</span>):</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># EXERCISE: Build the model according to the model summary shown above.</span></span><br><span class="line">        self._model = tf.keras.models.Sequential([</span><br><span class="line">            tf.keras.layers.Input(shape=(<span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>), dtype=tf.uint8),</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Use a Lambda layer to use the self.preprocess_fn function</span></span><br><span class="line">            <span class="comment"># defined above to preprocess the images.</span></span><br><span class="line">            <span class="comment"># YOUR CODE HERE</span></span><br><span class="line">            tf.keras.layers.Lambda(self.preprocess_fn),</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Create a Conv2D layer with 8 filters, a kernel size of 3</span></span><br><span class="line">            <span class="comment"># and padding=&#x27;same&#x27;.</span></span><br><span class="line">            <span class="comment"># YOUR CODE HERE</span></span><br><span class="line">            tf.keras.layers.Conv2D(filters = <span class="number">8</span>, kernel_size=<span class="number">3</span>, padding=<span class="string">&quot;same&quot;</span>),</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Create a MaxPool2D() layer. Use default values.</span></span><br><span class="line">            <span class="comment"># YOUR CODE HERE</span></span><br><span class="line">            tf.keras.layers.MaxPool2D(),</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Create a Conv2D layer with 16 filters, a kernel size of 3</span></span><br><span class="line">            <span class="comment"># and padding=&#x27;same&#x27;.</span></span><br><span class="line">            <span class="comment"># YOUR CODE HERE</span></span><br><span class="line">            tf.keras.layers.Conv2D(filters = <span class="number">16</span>, kernel_size=<span class="number">3</span>, padding=<span class="string">&quot;same&quot;</span>),</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Create a MaxPool2D() layer. Use default values.</span></span><br><span class="line">            <span class="comment"># YOUR CODE HERE</span></span><br><span class="line">            tf.keras.layers.MaxPool2D(),</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Create a Conv2D layer with 32 filters, a kernel size of 3</span></span><br><span class="line">            <span class="comment"># and padding=&#x27;same&#x27;.</span></span><br><span class="line">            <span class="comment"># YOUR CODE HERE</span></span><br><span class="line">            tf.keras.layers.Conv2D(filters = <span class="number">32</span>, kernel_size=<span class="number">3</span>, padding=<span class="string">&quot;same&quot;</span>),</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Create the Flatten and Dense layers as described in the </span></span><br><span class="line">            <span class="comment"># model summary shown above.</span></span><br><span class="line">            <span class="comment"># YOUR CODE HERE</span></span><br><span class="line">            </span><br><span class="line">            tf.keras.layers.Flatten(),</span><br><span class="line">            tf.keras.layers.Dense(<span class="number">128</span>),</span><br><span class="line">            tf.keras.layers.Dense(<span class="number">10</span>, activation=<span class="string">&quot;softmax&quot;</span>)</span><br><span class="line">        ])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># EXERCISE: Define the optimizer, loss function and metrics.</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Use the tf.keras.optimizers.Adam optimizer and set the</span></span><br><span class="line">        <span class="comment"># learning rate to self._learning_rate.</span></span><br><span class="line">        optimizer_fn = tf.keras.optimizers.Adam(learning_rate=self._learning_rate)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Use sparse_categorical_crossentropy as your loss function.</span></span><br><span class="line">        loss_fn = <span class="string">&quot;sparse_categorical_crossentropy&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Set the metrics to accuracy.</span></span><br><span class="line">        metrics_list = [<span class="string">&quot;accuracy&quot;</span>]</span><br><span class="line">     </span><br><span class="line">        <span class="comment"># Compile the model.</span></span><br><span class="line">        self._model.<span class="built_in">compile</span>(optimizer_fn, loss=loss_fn, metrics=metrics_list)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_prepare_dataset</span>(<span class="params">self</span>):</span></span><br><span class="line">        </span><br><span class="line">        filePath = <span class="string">f&quot;<span class="subst">&#123;getcwd()&#125;</span>/../tmp2&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># EXERCISE: Load the MNIST dataset using tfds.load(). Make sure to use</span></span><br><span class="line">        <span class="comment"># the argument data_dir=filePath. You should load the images as well</span></span><br><span class="line">        <span class="comment"># as their corresponding labels and load both the test and train splits.</span></span><br><span class="line">        dataset = tfds.load(<span class="string">&#x27;mnist&#x27;</span>, split=[<span class="string">&#x27;train&#x27;</span>, <span class="string">&#x27;test&#x27;</span>], data_dir = filePath, as_supervised=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># EXERCISE: Extract the &#x27;train&#x27; and &#x27;test&#x27; splits from the dataset above.</span></span><br><span class="line">        train_dataset, test_dataset = dataset</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> train_dataset, test_dataset</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span>(<span class="params">self</span>):</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># EXERCISE: Shuffle and batch the self.train_dataset. Use self._buffer_size</span></span><br><span class="line">        <span class="comment"># as the shuffling buffer and self._batch_size as the batch size for batching. </span></span><br><span class="line">        dataset_tr = self.train_dataset.shuffle(self._buffer_size).batch(self._batch_size)</span><br><span class="line">        </span><br><span class="line"><span class="comment">#         images, labels = next(iter(dataset_tr)).items()</span></span><br><span class="line"><span class="comment">#         print(images[1].shape) # (32, 28, 28, 1)</span></span><br><span class="line">             </span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Train the model for specified number of epochs.</span></span><br><span class="line">        self._model.fit(dataset_tr, epochs=self._epochs)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># EXERCISE: Batch the self.test_dataset. Use a batch size of 32.</span></span><br><span class="line">        dataset_te = self.test_dataset.batch(<span class="number">32</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Evaluate the dataset</span></span><br><span class="line">        results = self._model.evaluate(dataset_te)</span><br><span class="line">    </span><br><span class="line">        <span class="comment"># Print the metric values on which the model is being evaluated on.</span></span><br><span class="line">        <span class="keyword">for</span> name, value <span class="keyword">in</span> <span class="built_in">zip</span>(self._model.metrics_names, results):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;%s: %.3f&quot;</span> % (name, value))</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">export_model</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># Save the model.</span></span><br><span class="line">        tf.saved_model.save(self._model, self._export_path)</span><br></pre></td></tr></table></figure>
<h2 id="train-evaluate-and-save-the-model">Train, Evaluate, and Save the Model</h2>
<p>We will now use the <code>MNIST</code> class we created above to create an <code>mnist</code> object. When creating our <code>mnist</code> object we will use a dictionary to pass our training parameters. We will then call the <code>train</code> and <code>export_model</code> methods to train and save our model, respectively. Finally, we call the <code>test</code> method to evaluate our model after training.</p>
<p><strong>NOTE:</strong> It will take about 12 minutes to train the model for 5 epochs.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Define the training parameters.</span></span><br><span class="line">args = &#123;<span class="string">&#x27;export_path&#x27;</span>: <span class="string">&#x27;./saved_model&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;buffer_size&#x27;</span>: <span class="number">1000</span>,</span><br><span class="line">        <span class="string">&#x27;batch_size&#x27;</span>: <span class="number">32</span>,</span><br><span class="line">        <span class="string">&#x27;learning_rate&#x27;</span>: <span class="number">1e-3</span>,</span><br><span class="line">        <span class="string">&#x27;epochs&#x27;</span>: <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the mnist object. </span></span><br><span class="line">mnist = MNIST(**args)</span><br><span class="line"><span class="built_in">print</span>(mnist._model.summary())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Train the model.</span></span><br><span class="line">mnist.train()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save the model.</span></span><br><span class="line">mnist.export_model()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Evaluate the trained MNIST model.</span></span><br><span class="line">mnist.test()</span><br></pre></td></tr></table></figure>
<pre><code>WARNING:absl:Found a different version 3.0.0 of dataset mnist in data_dir /tf/week2/../tmp2. Using currently defined version 1.0.0.


Model: &quot;sequential_2&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
lambda_1 (Lambda)            (None, 28, 28, 1)         0         
_________________________________________________________________
conv2d_3 (Conv2D)            (None, 28, 28, 8)         80        
_________________________________________________________________
max_pooling2d_2 (MaxPooling2 (None, 14, 14, 8)         0         
_________________________________________________________________
conv2d_4 (Conv2D)            (None, 14, 14, 16)        1168      
_________________________________________________________________
max_pooling2d_3 (MaxPooling2 (None, 7, 7, 16)          0         
_________________________________________________________________
conv2d_5 (Conv2D)            (None, 7, 7, 32)          4640      
_________________________________________________________________
flatten_1 (Flatten)          (None, 1568)              0         
_________________________________________________________________
dense_1 (Dense)              (None, 128)               200832    
_________________________________________________________________
dense_2 (Dense)              (None, 10)                1290      
=================================================================
Total params: 208,010
Trainable params: 208,010
Non-trainable params: 0
_________________________________________________________________
None
Epoch 1/5
1875/1875 [==============================] - 135s 72ms/step - loss: 0.1548 - accuracy: 0.9532548 - accuracy: 0.95
Epoch 2/5
 563/1875 [========&gt;.....................] - ETA: 1:36 - loss: 0.0868 - accuracy: 0.9733</code></pre>
<h2 id="create-a-tarball">Create a Tarball</h2>
<p>The <code>export_model</code> method saved our model in the TensorFlow SavedModel format in the <code>./saved_model</code> directory. The SavedModel format saves our model and its weights in various files and directories. This makes it difficult to distribute our model. Therefore, it is convenient to create a single compressed file that contains all the files and folders of our model. To do this, we will use the <code>tar</code> archiving program to create a tarball (similar to a Zip file) that contains our SavedModel.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create a tarball from the SavedModel.</span></span><br><span class="line">!tar -cz -f module.tar.gz -C ./saved_model .</span><br></pre></td></tr></table></figure>
<h2 id="inspect-the-tarball">Inspect the Tarball</h2>
<p>We can uncompress our tarball to make sure it has all the files and folders from our SavedModel.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inspect the tarball.</span></span><br><span class="line">!tar -tf module.tar.gz</span><br></pre></td></tr></table></figure>
<pre><code>./
./variables/
./variables/variables.data-00001-of-00002
./variables/variables.data-00000-of-00002
./variables/variables.index
./saved_model.pb
./assets/</code></pre>
<h2 id="simulate-server-conditions">Simulate Server Conditions</h2>
<p>Once we have verified our tarball, we can now simulate server conditions. In a normal scenario, we will fetch our TF Hub module from a remote server using the module's handle. However, since this notebook cannot host the server, we will instead point the module handle to the directory where our SavedModel is stored.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">!rm -rf ./module</span><br><span class="line">!mkdir -p module</span><br><span class="line">!tar xvzf module.tar.gz -C ./module</span><br></pre></td></tr></table></figure>
<pre><code>./
./variables/
./variables/variables.data-00001-of-00002
./variables/variables.data-00000-of-00002
./variables/variables.index
./saved_model.pb
./assets/</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Define the module handle.</span></span><br><span class="line">MODULE_HANDLE = <span class="string">&#x27;./module&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="load-the-tf-hub-module">Load the TF Hub Module</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EXERCISE: Load the TF Hub module using the hub.load API.</span></span><br><span class="line">model = hub.load(MODULE_HANDLE)</span><br></pre></td></tr></table></figure>
<h2 id="test-the-tf-hub-module">Test the TF Hub Module</h2>
<p>We will now test our TF Hub module with images from the <code>test</code> split of the MNIST dataset.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">filePath = <span class="string">f&quot;<span class="subst">&#123;getcwd()&#125;</span>/../tmp2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># EXERCISE: Load the MNIST &#x27;test&#x27; split using tfds.load().</span></span><br><span class="line"><span class="comment"># Make sure to use the argument data_dir=filePath. You</span></span><br><span class="line"><span class="comment"># should load the images along with their corresponding labels.</span></span><br><span class="line"></span><br><span class="line">dataset = tfds.load(<span class="string">&#x27;mnist&#x27;</span>, split=tfds.Split.TEST, data_dir = filePath, as_supervised=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># EXERCISE: Batch the dataset using a batch size of 32.</span></span><br><span class="line">test_dataset = dataset.batch(<span class="number">32</span>)</span><br></pre></td></tr></table></figure>
<pre><code>WARNING:absl:Found a different version 3.0.0 of dataset mnist in data_dir /tf/week2/../tmp2. Using currently defined version 1.0.0.</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Test the TF Hub module for a single batch of data</span></span><br><span class="line"><span class="keyword">for</span> batch_data <span class="keyword">in</span> test_dataset.take(<span class="number">1</span>):</span><br><span class="line">    outputs = model(batch_data[<span class="number">0</span>])</span><br><span class="line">    outputs = np.argmax(outputs, axis=-<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Predicted Labels:&#x27;</span>, outputs)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;True Labels:     &#x27;</span>, batch_data[<span class="number">1</span>].numpy())</span><br></pre></td></tr></table></figure>
<pre><code>Predicted Labels: [6 2 3 7 2 2 3 4 7 6 6 9 2 0 9 6 2 0 6 5 1 4 8 1 9 8 4 0 0 5 8 4]
True Labels:      [6 2 3 7 2 2 3 4 7 6 6 9 2 0 9 6 8 0 6 5 1 4 8 1 9 8 4 0 0 5 2 4]</code></pre>
<p>We can see that the model correctly predicts the labels for most images in the batch.</p>
<h2 id="evaluate-the-model-using-keras">Evaluate the Model Using Keras</h2>
<p>In the cell below, you will integrate the TensorFlow Hub module into the high level Keras API.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EXERCISE: Integrate the TensorFlow Hub module into a Keras</span></span><br><span class="line"><span class="comment"># sequential model. You should use a hub.KerasLayer and you </span></span><br><span class="line"><span class="comment"># should make sure to use the correct values for the output_shape,</span></span><br><span class="line"><span class="comment"># and input_shape parameters. You should also use tf.uint8 for</span></span><br><span class="line"><span class="comment"># the dtype parameter.</span></span><br><span class="line"></span><br><span class="line">model = tf.keras.Sequential([</span><br><span class="line">    hub.KerasLayer(model, output_shape=[<span class="number">10</span>], input_shape=[<span class="number">28</span>,<span class="number">28</span>,<span class="number">1</span>], </span><br><span class="line">                           dtype=tf.uint8)</span><br><span class="line">]) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Compile the model.</span></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;adam&#x27;</span>,</span><br><span class="line">              loss=<span class="string">&#x27;sparse_categorical_crossentropy&#x27;</span>, </span><br><span class="line">              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Evaluate the model on the test_dataset.</span></span><br><span class="line">results = model.evaluate(test_dataset)</span><br></pre></td></tr></table></figure>
<pre><code>313/313 [==============================] - 27s 88ms/step - loss: 0.0605 - accuracy: 0.9824</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Print the metric values on which the model is being evaluated on.</span></span><br><span class="line"><span class="keyword">for</span> name, value <span class="keyword">in</span> <span class="built_in">zip</span>(model.metrics_names, results):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;%s: %.3f&quot;</span> % (name, value))</span><br></pre></td></tr></table></figure>
<pre><code>loss: 0.061
accuracy: 0.982</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/Tensorflow-Serving/2020/02/21/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Tensorflow-Serving/2020/02/21/" class="post-title-link" itemprop="url">Tensorflow Serving</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-21 23:37:47" itemprop="dateCreated datePublished" datetime="2020-02-21T23:37:47+08:00">2020-02-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-08 02:05:41" itemprop="dateModified" datetime="2020-04-08T02:05:41+08:00">2020-04-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/" itemprop="url" rel="index"><span itemprop="name">Artificial Intelligence</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Artificial-Intelligence/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI-Workflow/" itemprop="url" rel="index"><span itemprop="name">AI Workflow</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI-Workflow/Deployment/" itemprop="url" rel="index"><span itemprop="name">Deployment</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/Tensorflow-Serving/2020/02/21/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Tensorflow-Serving/2020/02/21/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="train-your-own-model-and-serve-it-with-tensorflow-serving">Train Your Own Model and Serve It With TensorFlow Serving</h1>
<p>In this notebook, you will train a neural network to classify images of handwritten digits from the <a target="_blank" rel="noopener" href="http://yann.lecun.com/exdb/mnist/">MNIST</a> dataset. You will then save the trained model, and serve it using <a target="_blank" rel="noopener" href="https://www.tensorflow.org/tfx/guide/serving">TensorFlow Serving</a>.</p>
<h2 id="setup">Setup</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    %tensorflow_version <span class="number">2.</span>x</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\u2022 Using TensorFlow Version:&quot;</span>, tf.__version__)</span><br></pre></td></tr></table></figure>
<p>Using TensorFlow Version: 2.2.0-dev20200217</p>
<h2 id="import-the-mnist-dataset">Import the MNIST Dataset</h2>
<p>The <a target="_blank" rel="noopener" href="http://yann.lecun.com/exdb/mnist/">MNIST</a> dataset contains 70,000 grayscale images of the digits 0 through 9. The images show individual digits at a low resolution (28 by 28 pixels).</p>
<p>Even though these are really images, we will load them as NumPy arrays and not as binary image objects.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mnist = tf.keras.datasets.mnist</span><br><span class="line">(train_images, train_labels), (test_images, test_labels) = mnist.load_data()</span><br></pre></td></tr></table></figure>
<pre><code>Downloading data from https://storage.googleapis.com/tensorflow/tf-keras-datasets/mnist.npz
11493376/11490434 [==============================] - 1s 0us/step</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EXERCISE: Scale the values of the arrays below to be between 0.0 and 1.0.</span></span><br><span class="line">train_images = train_images / <span class="number">255.0</span></span><br><span class="line">test_images =  test_images / <span class="number">255.0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_images.shape, test_images.shape</span><br></pre></td></tr></table></figure>
<pre><code>((60000, 28, 28), (10000, 28, 28))</code></pre>
<p>In the cell below use the <code>.reshape</code> method to resize the arrays to the following sizes:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train_images.shape: (<span class="number">60000</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)</span><br><span class="line">test_images.shape: (<span class="number">10000</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EXERCISE: Reshape the arrays below.</span></span><br><span class="line">train_images = train_images.reshape((*train_images.shape,<span class="number">1</span>))</span><br><span class="line">test_images =  test_images.reshape((*test_images.shape,<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\ntrain_images.shape: &#123;&#125;, of &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(train_images.shape, train_images.dtype))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;test_images.shape: &#123;&#125;, of &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(test_images.shape, test_images.dtype))</span><br></pre></td></tr></table></figure>
<pre><code>train_images.shape: (60000, 28, 28, 1), of float64
test_images.shape: (10000, 28, 28, 1), of float64</code></pre>
<h2 id="look-at-a-sample-image">Look at a Sample Image</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">idx = <span class="number">42</span></span><br><span class="line"></span><br><span class="line">plt.imshow(test_images[idx].reshape(<span class="number">28</span>,<span class="number">28</span>), cmap=plt.cm.binary)</span><br><span class="line">plt.title(<span class="string">&#x27;True Label: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(test_labels[idx]), fontdict=&#123;<span class="string">&#x27;size&#x27;</span>: <span class="number">16</span>&#125;)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<figure>
<img src="output_14_0.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<h2 id="build-a-model">Build a Model</h2>
<p>In the cell below build a <code>tf.keras.Sequential</code> model that can be used to classify the images of the MNIST dataset. Feel free to use the simplest possible CNN. Make sure your model has the correct <code>input_shape</code> and the correct number of output units.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EXERCISE: Create a model.</span></span><br><span class="line">model =  tf.keras.Sequential([</span><br><span class="line">    </span><br><span class="line">        tf.keras.layers.Conv2D(input_shape=(<span class="number">28</span>,<span class="number">28</span>,<span class="number">1</span>), filters=<span class="number">8</span>, kernel_size=<span class="number">3</span>,</span><br><span class="line">                               strides=<span class="number">2</span>, activation=<span class="string">&#x27;relu&#x27;</span>, name=<span class="string">&#x27;Conv1&#x27;</span>),</span><br><span class="line">        tf.keras.layers.Flatten(),</span><br><span class="line">        tf.keras.layers.Dense(<span class="number">10</span>, activation=tf.nn.softmax, name=<span class="string">&#x27;Softmax&#x27;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure>
<pre><code>Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
Conv1 (Conv2D)               (None, 13, 13, 8)         80        
_________________________________________________________________
flatten (Flatten)            (None, 1352)              0         
_________________________________________________________________
Softmax (Dense)              (None, 10)                13530     
=================================================================
Total params: 13,610
Trainable params: 13,610
Non-trainable params: 0
_________________________________________________________________</code></pre>
<h2 id="train-the-model">Train the Model</h2>
<p>In the cell below configure your model for training using the <code>adam</code> optimizer, <code>sparse_categorical_crossentropy</code> as the loss, and <code>accuracy</code> for your metrics. Then train the model for the given number of epochs, using the <code>train_images</code> array.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EXERCISE: Configure the model for training.</span></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer = <span class="string">&quot;adam&quot;</span>, loss = <span class="string">&quot;sparse_categorical_crossentropy&quot;</span>, metrics=[<span class="string">&quot;accuracy&quot;</span>])</span><br><span class="line"></span><br><span class="line">epochs = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># EXERCISE: Train the model.</span></span><br><span class="line">history = model.fit(train_images, train_labels,</span><br><span class="line">                    batch_size = <span class="number">16</span>,</span><br><span class="line">                    epochs = epochs,</span><br><span class="line">                    validation_data= [test_images, test_labels],</span><br><span class="line">                    verbose = <span class="number">1</span></span><br><span class="line">                   )</span><br></pre></td></tr></table></figure>
<pre><code>Train on 60000 samples, validate on 10000 samples
Epoch 1/5
60000/60000 [==============================] - 8s 127us/sample - loss: 0.3098 - accuracy: 0.9120 - val_loss: 0.1723 - val_accuracy: 0.9489
Epoch 2/5
60000/60000 [==============================] - 7s 121us/sample - loss: 0.1511 - accuracy: 0.9569 - val_loss: 0.1145 - val_accuracy: 0.9667
Epoch 3/5
60000/60000 [==============================] - 7s 122us/sample - loss: 0.1103 - accuracy: 0.9680 - val_loss: 0.0939 - val_accuracy: 0.9720
Epoch 4/5
60000/60000 [==============================] - 7s 121us/sample - loss: 0.0901 - accuracy: 0.9737 - val_loss: 0.0895 - val_accuracy: 0.9739
Epoch 5/5
60000/60000 [==============================] - 7s 121us/sample - loss: 0.0780 - accuracy: 0.9763 - val_loss: 0.0787 - val_accuracy: 0.9758</code></pre>
<h2 id="evaluate-the-model">Evaluate the Model</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EXERCISE: Evaluate the model on the test images.</span></span><br><span class="line">results_eval = model.evaluate(test_images, test_labels)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> metric, value <span class="keyword">in</span> <span class="built_in">zip</span>(model.metrics_names, results_eval):</span><br><span class="line">    <span class="built_in">print</span>(metric + <span class="string">&#x27;: &#123;:.3&#125;&#x27;</span>.<span class="built_in">format</span>(value))</span><br></pre></td></tr></table></figure>
<pre><code>10000/10000 [==============================] - 0s 39us/sample - loss: 0.0787 - accuracy: 0.9758
loss: 0.0787
accuracy: 0.976</code></pre>
<h2 id="save-the-model">Save the Model</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MODEL_DIR = <span class="string">&quot;digits_model&quot;</span></span><br><span class="line"></span><br><span class="line">version = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">export_path = os.path.join(MODEL_DIR, <span class="built_in">str</span>(version))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.isdir(export_path):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\nAlready saved a model, cleaning up\n&#x27;</span>)</span><br><span class="line">    !rm -r &#123;export_path&#125;</span><br><span class="line"></span><br><span class="line">model.save(export_path, save_format=<span class="string">&quot;tf&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\nexport_path = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(export_path))</span><br><span class="line">!ls -l &#123;export_path&#125;</span><br></pre></td></tr></table></figure>
<h2 id="examine-your-saved-model">Examine Your Saved Model</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!saved_model_cli show --<span class="built_in">dir</span> &#123;export_path&#125; --<span class="built_in">all</span></span><br></pre></td></tr></table></figure>
<pre><code>MetaGraphDef with tag-set: &#39;serve&#39; contains the following SignatureDefs:

signature_def[&#39;__saved_model_init_op&#39;]:
  The given SavedModel SignatureDef contains the following input(s):
  The given SavedModel SignatureDef contains the following output(s):
    outputs[&#39;__saved_model_init_op&#39;] tensor_info:
        dtype: DT_INVALID
        shape: unknown_rank
        name: NoOp
  Method name is: 

signature_def[&#39;serving_default&#39;]:
  The given SavedModel SignatureDef contains the following input(s):
    inputs[&#39;Conv1_input&#39;] tensor_info:
        dtype: DT_FLOAT
        shape: (-1, 28, 28, 1)
        name: serving_default_Conv1_input:0
  The given SavedModel SignatureDef contains the following output(s):
    outputs[&#39;Softmax&#39;] tensor_info:
        dtype: DT_FLOAT
        shape: (-1, 10)
        name: StatefulPartitionedCall:0
  Method name is: tensorflow/serving/predict
WARNING:tensorflow:From /Users/ZRC/miniconda3/envs/tryit/lib/python3.6/site-packages/tensorflow/python/ops/resource_variable_ops.py:1809: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.

Defined Functions:
  Function Name: &#39;__call__&#39;
    Option #1
      Callable with:
        Argument #1
          inputs: TensorSpec(shape=(None, 28, 28, 1), dtype=tf.float32, name=&#39;inputs&#39;)
        Argument #2
          DType: bool
          Value: False
        Argument #3
          DType: NoneType
          Value: None
    Option #2
      Callable with:
        Argument #1
          Conv1_input: TensorSpec(shape=(None, 28, 28, 1), dtype=tf.float32, name=&#39;Conv1_input&#39;)
        Argument #2
          DType: bool
          Value: False
        Argument #3
          DType: NoneType
          Value: None
    Option #3
      Callable with:
        Argument #1
          Conv1_input: TensorSpec(shape=(None, 28, 28, 1), dtype=tf.float32, name=&#39;Conv1_input&#39;)
        Argument #2
          DType: bool
          Value: True
        Argument #3
          DType: NoneType
          Value: None
    Option #4
      Callable with:
        Argument #1
          inputs: TensorSpec(shape=(None, 28, 28, 1), dtype=tf.float32, name=&#39;inputs&#39;)
        Argument #2
          DType: bool
          Value: True
        Argument #3
          DType: NoneType
          Value: None

  Function Name: &#39;_default_save_signature&#39;
    Option #1
      Callable with:
        Argument #1
          Conv1_input: TensorSpec(shape=(None, 28, 28, 1), dtype=tf.float32, name=&#39;Conv1_input&#39;)

  Function Name: &#39;call_and_return_all_conditional_losses&#39;
    Option #1
      Callable with:
        Argument #1
          Conv1_input: TensorSpec(shape=(None, 28, 28, 1), dtype=tf.float32, name=&#39;Conv1_input&#39;)
        Argument #2
          DType: bool
          Value: False
        Argument #3
          DType: NoneType
          Value: None
    Option #2
      Callable with:
        Argument #1
          Conv1_input: TensorSpec(shape=(None, 28, 28, 1), dtype=tf.float32, name=&#39;Conv1_input&#39;)
        Argument #2
          DType: bool
          Value: True
        Argument #3
          DType: NoneType
          Value: None
    Option #3
      Callable with:
        Argument #1
          inputs: TensorSpec(shape=(None, 28, 28, 1), dtype=tf.float32, name=&#39;inputs&#39;)
        Argument #2
          DType: bool
          Value: True
        Argument #3
          DType: NoneType
          Value: None
    Option #4
      Callable with:
        Argument #1
          inputs: TensorSpec(shape=(None, 28, 28, 1), dtype=tf.float32, name=&#39;inputs&#39;)
        Argument #2
          DType: bool
          Value: False
        Argument #3
          DType: NoneType
          Value: None</code></pre>
<h2 id="add-tensorflow-serving-distribution-uri-as-a-package-source">Add TensorFlow Serving Distribution URI as a Package Source</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This is the same as you would do from your command line, but without the [arch=amd64], and no sudo</span></span><br><span class="line"><span class="comment"># You would instead do:</span></span><br><span class="line"><span class="comment"># echo &quot;deb [arch=amd64] http://storage.googleapis.com/tensorflow-serving-apt stable tensorflow-model-server tensorflow-model-server-universal&quot; | sudo tee /etc/apt/sources.list.d/tensorflow-serving.list &amp;&amp; \</span></span><br><span class="line"><span class="comment"># curl https://storage.googleapis.com/tensorflow-serving-apt/tensorflow-serving.release.pub.gpg | sudo apt-key add -</span></span><br><span class="line"></span><br><span class="line">!echo <span class="string">&quot;deb http://storage.googleapis.com/tensorflow-serving-apt stable tensorflow-model-server tensorflow-model-server-universal&quot;</span> | tee /etc/apt/sources.<span class="built_in">list</span>.d/tensorflow-serving.<span class="built_in">list</span> &amp;&amp; \</span><br><span class="line">curl https://storage.googleapis.com/tensorflow-serving-apt/tensorflow-serving.release.pub.gpg | apt-key add -</span><br><span class="line">!apt update</span><br></pre></td></tr></table></figure>
<pre><code>tee: /etc/apt/sources.list.d/tensorflow-serving.list: No such file or directory
deb http://storage.googleapis.com/tensorflow-serving-apt stable tensorflow-model-server tensorflow-model-server-universal
Unable to locate an executable at &quot;/Library/Java/JavaVirtualMachines/jdk1.8.0_73.jdk/Contents/Home/bin/apt&quot; (-1)</code></pre>
<h2 id="install-tensorflow-serving">Install TensorFlow Serving</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!apt-get install tensorflow-model-server</span><br></pre></td></tr></table></figure>
<pre><code>/bin/sh: apt-get: command not found</code></pre>
<h2 id="run-the-tensorflow-model-server">Run the TensorFlow Model Server</h2>
<p>You will now launch the TensorFlow model server with a bash script. In the cell below use the following parameters when running the TensorFlow model server:</p>
<ul>
<li><p><code>rest_api_port</code>: Use port <code>8501</code> for your requests.</p></li>
<li><p><code>model_name</code>: Use <code>digits_model</code> as your model name.</p></li>
<li><p><code>model_base_path</code>: Use the environment variable <code>MODEL_DIR</code> defined below as the base path to the saved model.</p></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.environ[<span class="string">&quot;MODEL_DIR&quot;</span>] = MODEL_DIR</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MODEL_DIR</span><br></pre></td></tr></table></figure>
<pre><code>&#39;digits_model&#39;</code></pre>
<ul>
<li>-p 8501:8501 : Publishing the containers port 8501 (where TF Serving responds to REST API requests) to the hosts port 8501</li>
<li>--mount type=bind,source=/tmp/resnet,target=/models/resnet : Mounting the hosts local directory (/tmp/resnet) on the container (/models/resnet) so TF Serving can read the model from inside the container.</li>
<li>-e MODEL_NAME=digits_model : Telling TensorFlow Serving to load the model named digits_model</li>
<li>-t tensorflow/serving : Running a Docker container based on the serving image tensorflow/serving</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">%%bash</span><br><span class="line"></span><br><span class="line">nohup docker run -p 8501:8501 \</span><br><span class="line">  --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,<span class="built_in">source</span>=<span class="string">&quot;/Users/ZRC/Desktop/TensorFlow Data and Deployment/week13/Exercises/digits_model,target=/models/digits_model&quot;</span> \</span><br><span class="line">  -e MODEL_NAME=digits_model -t tensorflow/serving  &amp;</span><br></pre></td></tr></table></figure>
<pre><code>docker: Error response from daemon: driver failed programming external connectivity on endpoint wonderful_ganguly (32049ac8fc320931031b817d6269004dcac5878b1e8c8addceb79fb1cd5dca24): Bind for 0.0.0.0:8501 failed: port is already allocated.</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># # EXERCISE: Fill in the missing code below.</span></span><br><span class="line"><span class="comment"># %%bash --bg </span></span><br><span class="line"><span class="comment"># nohup tensorflow_model_server \</span></span><br><span class="line"><span class="comment">#   --rest_api_port=8501 \</span></span><br><span class="line"><span class="comment">#   --model_name=digits_model \</span></span><br><span class="line"><span class="comment">#   --model_base_path=&quot;$&#123;MODEL_DIR&#125;&quot; &gt;server.log 2&gt;&amp;1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!tail server.log</span><br></pre></td></tr></table></figure>
<pre><code>docker: Error response from daemon: driver failed programming external connectivity on endpoint determined_antonelli (6a4d67f3751bc7f9fed7821f6df430cbf368992e00c710738cb6f1d9f1e647d2): Bind for 0.0.0.0:8501 failed: port is already allocated.</code></pre>
<h2 id="create-json-object-with-test-images">Create JSON Object with Test Images</h2>
<p>In the cell below construct a JSON object and use the first three images of the testing set (<code>test_images</code>) as your data.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EXERCISE: Create JSON Object</span></span><br><span class="line">data = data = json.dumps(&#123;<span class="string">&quot;signature_name&quot;</span>: <span class="string">&quot;serving_default&quot;</span>, <span class="string">&quot;instances&quot;</span>: test_images[<span class="number">0</span>:<span class="number">3</span>].tolist()&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="make-inference-request">Make Inference Request</h2>
<p>In the cell below, send a predict request as a POST to the server's REST endpoint, and pass it your test data. You should ask the server to give you the latest version of your model.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EXERCISE: Fill in the code below</span></span><br><span class="line">headers = &#123;<span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/json&quot;</span>&#125;</span><br><span class="line">json_response = requests.post(<span class="string">&#x27;http://localhost:8501/v1/models/digits_model:predict&#x27;</span>, data=data, headers=headers)</span><br><span class="line">    </span><br><span class="line">predictions = json.loads(json_response.text)[<span class="string">&#x27;predictions&#x27;</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">predictions</span><br></pre></td></tr></table></figure>
<pre><code>[[1.68959902e-09,
  3.5654768e-10,
  4.89267848e-07,
  6.09665512e-05,
  5.58686e-10,
  2.27727126e-09,
  8.49646383e-15,
  0.999936819,
  1.21679037e-07,
  1.63355e-06],
 [1.37625943e-06,
  6.47248962e-05,
  0.99961108,
  4.23558049e-06,
  5.8764843e-10,
  7.63888067e-07,
  0.000306190021,
  2.43645703e-15,
  1.15736648e-05,
  8.24755108e-12],
 [2.70507389e-05,
  0.996317267,
  0.00121238839,
  1.1719947e-05,
  0.00065574795,
  2.86702857e-06,
  0.000181563752,
  0.000955980679,
  0.000630841067,
  4.60029833e-06]]</code></pre>
<h2 id="plot-predictions">Plot Predictions</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">15</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    plt.subplot(<span class="number">1</span>,<span class="number">3</span>,i+<span class="number">1</span>)</span><br><span class="line">    plt.imshow(test_images[i].reshape(<span class="number">28</span>,<span class="number">28</span>), cmap = plt.cm.binary)</span><br><span class="line">    plt.axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">    color = <span class="string">&#x27;green&#x27;</span> <span class="keyword">if</span> np.argmax(predictions[i]) == test_labels[i] <span class="keyword">else</span> <span class="string">&#x27;red&#x27;</span></span><br><span class="line">    plt.title(<span class="string">&#x27;Prediction: &#123;&#125;\nTrue Label: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(np.argmax(predictions[i]), test_labels[i]), color=color)</span><br><span class="line">    </span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<figure>
<img src="output_42_0.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/Improving-Performance-of-Tensorflow-ETL-pipeline/2020/02/20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Improving-Performance-of-Tensorflow-ETL-pipeline/2020/02/20/" class="post-title-link" itemprop="url">Improving Performance of Tensorflow ETL Pipeline</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-20 02:17:20" itemprop="dateCreated datePublished" datetime="2020-02-20T02:17:20+08:00">2020-02-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-12-31 15:47:36" itemprop="dateModified" datetime="2021-12-31T15:47:36+08:00">2021-12-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI-Workflow/" itemprop="url" rel="index"><span itemprop="name">AI Workflow</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI-Workflow/ETL/" itemprop="url" rel="index"><span itemprop="name">ETL</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/Improving-Performance-of-Tensorflow-ETL-pipeline/2020/02/20/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Improving-Performance-of-Tensorflow-ETL-pipeline/2020/02/20/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Improving Performance of Tensorflow ETL Pipeline</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/Improving-Performance-of-Tensorflow-ETL-pipeline/2020/02/20/">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ruochi Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">268</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhangruochi" title="GitHub  https:&#x2F;&#x2F;github.com&#x2F;zhangruochi" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zrc720@gmail.com" title="E-Mail  mailto:zrc720@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.healthinformaticslab.org/" title="http:&#x2F;&#x2F;www.healthinformaticslab.org" rel="noopener" target="_blank">HILab</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.shihaizhou.com/" title="http:&#x2F;&#x2F;www.shihaizhou.com" rel="noopener" target="_blank">Rose</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/cherish_CX/" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;cherish_CX&#x2F;" rel="noopener" target="_blank">Chunxia</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019  
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ruochi Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/js/algolia-search.js"></script>














  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'qW3MLcAgcX96sB6qbegeL7rP-gzGzoHsz',
      appKey     : 'GL6JvT9DgGxqYrY5Vj6bXVuv',
      placeholder: "Thank you for your reply",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>

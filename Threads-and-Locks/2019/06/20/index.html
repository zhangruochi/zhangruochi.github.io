<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PingFang SC:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhangruochi.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":5,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Threads and Locks">
<meta property="og:type" content="article">
<meta property="og:title" content="Threads and Locks">
<meta property="og:url" content="https://zhangruochi.com/Threads-and-Locks/2019/06/20/index.html">
<meta property="og:site_name" content="RUOCHI.AI">
<meta property="og:description" content="Threads and Locks">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhangruochi.com/Threads-and-Locks/2019/06/20/2.png">
<meta property="og:image" content="https://zhangruochi.com/Threads-and-Locks/2019/06/20/3.png">
<meta property="og:image" content="https://zhangruochi.com/Threads-and-Locks/2019/06/20/1.png">
<meta property="article:published_time" content="2019-06-20T15:34:52.000Z">
<meta property="article:modified_time" content="2022-01-18T06:34:46.237Z">
<meta property="article:author" content="Ruochi Zhang">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhangruochi.com/Threads-and-Locks/2019/06/20/2.png">

<link rel="canonical" href="https://zhangruochi.com/Threads-and-Locks/2019/06/20/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Threads and Locks | RUOCHI.AI</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">RUOCHI.AI</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/Threads-and-Locks/2019/06/20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Threads and Locks
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-06-20 23:34:52" itemprop="dateCreated datePublished" datetime="2019-06-20T23:34:52+08:00">2019-06-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-01-18 14:34:46" itemprop="dateModified" datetime="2022-01-18T14:34:46+08:00">2022-01-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Big-Data-Architecture/" itemprop="url" rel="index"><span itemprop="name">Big Data Architecture</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Big-Data-Architecture/Parallel-Computation/" itemprop="url" rel="index"><span itemprop="name">Parallel Computation</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/Threads-and-Locks/2019/06/20/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Threads-and-Locks/2019/06/20/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <div class="post-description">Threads and Locks</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="table-of-contents">Table of Contents</h1>
<ul>
<li><a href="#threads">Threads</a></li>
<li><a href="#structured-locks">Structured Locks</a></li>
<li><a href="#unstructured-locks">Unstructured Locks</a></li>
<li><a href="#liveness-and-progress-guarantees">Liveness and Progress Guarantees</a>
<ul>
<li><a href="#synchronized-ç”¨æ³•">synchronized ç”¨æ³•</a></li>
</ul></li>
<li><a href="#deadlocks-example">Deadlockâ€˜s example</a></li>
<li><a href="#dining-philosophers-problem">Dining Philosophers Problem</a></li>
</ul>
<h2 id="threads">Threads</h2>
<blockquote>
<p>Now, threads have been around for over five decades and they are the assembly language of parallel execution. Every operating system supports threads in one form or the other. And the way they work right under the hood is that if you have a multicore processor and I'll just show two processors, P0, P1, you have the ability to create units of execution called threads, T1, T2, T3. And the operating system takes care of scheduling these threads on processors as they're available.</p>
</blockquote>
<p>When an instance of ğšƒğš‘ğš›ğšğšŠğš is <strong>created</strong> (via a ğš—ğšğš  operation), it does not start executing right away; instead, it can only start executing when its <strong>ğšœğšğšŠğš›ğš()</strong> method is invoked. The statement or computation to be executed by the thread is specified as a parameter to the constructor.</p>
<p>The Thread class also includes a wait operation in the form of a ğš“ğš˜ğš’ğš—() method. If thread ğšğŸ¶ performs a ğšğŸ·.ğš“ğš˜ğš’ğš—() call, thread ğšğŸ¶ will be forced to wait until thread ğšğŸ· completes, after which point it can safely access any values computed by thread ğšğŸ·. Since there is no restriction on which thread can perform a ğš“ğš˜ğš’ğš— on which other thread, it is possible for a programmer to erroneously create a deadlock cycle with ğš“ğš˜ğš’ğš— operations. (A deadlock occurs when two threads wait for each other indefinitely, so that neither can make any progress.)</p>
<h2 id="structured-locks">Structured Locks</h2>
<ul>
<li><p>To enforce mutual exclusion and avoid data races</p></li>
<li><p>Can be implemented using ğšœğš¢ğš—ğšŒğš‘ğš›ğš˜ğš—ğš’ğš£ğšğš statements and methods in Java &gt; their acquire and release operations are implicit, since these operations are automatically performed by the Java runtime environment when entering and exiting the scope of a ğšœğš¢ğš—ğšŒğš‘ğš›ğš˜ğš—ğš’ğš£ğšğš statement or method, even if an exception is thrown in the middle.</p></li>
<li><p>WğšŠğš’ğš() and Nğš˜ğšğš’ğšğš¢() operations that can be used to block and resume threads that need to wait for specific conditions.</p></li>
<li><p>Structured locks are also referred to as intrinsic locks or monitors.</p></li>
</ul>
<h2 id="unstructured-locks">Unstructured Locks</h2>
<p>In this lecture, we introduced unstructured locks (which can be obtained in Java by creating instances of ğšğšğšğš—ğšğš›ğšŠğš—ğšğ™»ğš˜ğšŒğš”()), and used three examples to demonstrate their generality relative to structured locks.</p>
<ol type="1">
<li>Explicit ğš•ğš˜ğšŒğš”() and ğšğš—ğš•ğš˜ğšŒğš”(), support a hand-over-hand locking pattern that implements a non-nested pairing of lock/unlock operations which cannot be achieved with synchronized statements/methods.</li>
<li>ğšğš›ğš¢ğ™»ğš˜ğšŒğš”() operations in unstructured locks can enable a thread to check the availability of a lock, and thereby acquire it if it is available or do something else if it is not.</li>
<li>read-write locks (which can be obtained in Java by creating instances of ğšğšğšğš—ğšğš›ğšŠğš—ğšğšğšğšŠğšğš†ğš›ğš’ğšğšğ™»ğš˜ğšŒğš”()), whereby multiple threads are permitted to acquire a lock ğ™» in â€œread modeâ€, ğ™».ğš›ğšğšŠğšğ™»ğš˜ğšŒğš”().ğš•ğš˜ğšŒğš”(), but only one thread is permitted to acquire the lock in â€œwrite modeâ€, ğ™».ğš ğš›ğš’ğšğšğ™»ğš˜ğšŒğš”().ğš•ğš˜ğšŒğš”().</li>
</ol>
<p><strong>However, it is also important to remember that the generality and power of unstructured locks is accompanied by an extra responsibility on the part of the programmer, e.g., ensuring that calls to ğšğš—ğš•ğš˜ğšŒğš”() are not forgotten, even in the presence of exceptions.</strong></p>
<p><img src="2.png" /></p>
<h2 id="liveness-and-progress-guarantees">Liveness and Progress Guarantees</h2>
<p>There are three ways in which a parallel program may enter a state in which it stops making forward progress. For sequential programs, an â€œinfinite loopâ€ is a common way for a program to stop making forward progress, but there are other ways to obtain an absence of progress in a parallel program.</p>
<ol type="1">
<li><strong>Deadlock</strong>: all threads are blocked indefinitely, thereby preventing any forward progress.</li>
<li><strong>Livelock</strong>: all threads repeatedly perform an interaction that prevents forward progress, e.g., an infinite â€œloopâ€ of repeating lock acquire/release patterns.</li>
<li><strong>starvation</strong>: at least one thread is prevented from making any forward progress.</li>
</ol>
<p>The term â€œlivenessâ€ refers to a progress guarantee. The three progress guarantees that correspond to the absence of the conditions listed above are deadlock freedom, livelock freedom, and starvation freedom.</p>
<p><img src="3.png" /></p>
<h3 id="synchronized-ç”¨æ³•">synchronized ç”¨æ³•</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// --------------------- </span></span><br><span class="line"><span class="comment">// ä½œè€…ï¼šå‰å‰å“¥ </span></span><br><span class="line"><span class="comment">// æ¥æºï¼šCSDN </span></span><br><span class="line"><span class="comment">// åŸæ–‡ï¼šhttps://blog.csdn.net/xiao__gui/article/details/8188833 </span></span><br><span class="line"><span class="comment">// ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·é™„ä¸Šåšæ–‡é“¾æ¥ï¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sync</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;testå¼€å§‹..&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;testç»“æŸ..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Sync sync = <span class="keyword">new</span> Sync();</span><br><span class="line">        sync.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            Thread thread = <span class="keyword">new</span> MyThread();</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment">// testå¼€å§‹..</span></span><br><span class="line"><span class="comment">// testå¼€å§‹..</span></span><br><span class="line"><span class="comment">// testå¼€å§‹..</span></span><br><span class="line"><span class="comment">// testç»“æŸ..</span></span><br><span class="line"><span class="comment">// testç»“æŸ..</span></span><br><span class="line"><span class="comment">// testç»“æŸ..</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ç¨‹åºèµ·äº†ä¸‰ä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶è¿è¡ŒSyncç±»ä¸­çš„test()æ–¹æ³•ï¼Œè™½ç„¶test()æ–¹æ³•åŠ ä¸Šäº†synchronizedï¼Œä½†æ˜¯è¿˜æ˜¯åŒæ—¶è¿è¡Œèµ·æ¥ï¼Œsynchronizedæ²¡èµ·ä½œç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;testå¼€å§‹..&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;testç»“æŸ..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment">// testå¼€å§‹..</span></span><br><span class="line"><span class="comment">// testå¼€å§‹..</span></span><br><span class="line"><span class="comment">// testå¼€å§‹..</span></span><br><span class="line"><span class="comment">// testç»“æŸ..</span></span><br><span class="line"><span class="comment">// testç»“æŸ..</span></span><br><span class="line"><span class="comment">// testç»“æŸ..</span></span><br></pre></td></tr></table></figure>
<p>æ²¡æœ‰çœ‹åˆ°synchronizedèµ·åˆ°ä½œç”¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> Sync sync;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyThread</span><span class="params">(Sync sync)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sync = sync;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        sync.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Sync sync = <span class="keyword">new</span> Sync();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            Thread thread = <span class="keyword">new</span> MyThread(sync);</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment">// testå¼€å§‹..</span></span><br><span class="line"><span class="comment">// testç»“æŸ..</span></span><br><span class="line"><span class="comment">// testå¼€å§‹..</span></span><br><span class="line"><span class="comment">// testç»“æŸ..</span></span><br><span class="line"><span class="comment">// testå¼€å§‹..</span></span><br><span class="line"><span class="comment">// testç»“æŸ..</span></span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶çš„synchronizedå°±èµ·äº†ä½œç”¨ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>synchronizedé”ä½çš„æ˜¯æ‹¬å·é‡Œçš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä»£ç </strong>ã€‚å¯¹äºéstaticçš„synchronizedæ–¹æ³•ï¼Œé”çš„å°±æ˜¯å¯¹è±¡æœ¬èº«ä¹Ÿå°±æ˜¯thisã€‚å½“synchronizedé”ä½ä¸€ä¸ªå¯¹è±¡åï¼Œåˆ«çš„çº¿ç¨‹å¦‚æœä¹Ÿæƒ³æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œå°±å¿…é¡»ç­‰å¾…è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆé‡Šæ”¾é”ï¼Œæ‰èƒ½å†æ¬¡ç»™å¯¹è±¡åŠ é”ï¼Œè¿™æ ·æ‰è¾¾åˆ°çº¿ç¨‹åŒæ­¥çš„ç›®çš„ã€‚å³ä½¿ä¸¤ä¸ªä¸åŒçš„ä»£ç æ®µï¼Œéƒ½è¦é”åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªä»£ç æ®µä¹Ÿä¸èƒ½åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åŒæ—¶è¿è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ç”¨synchronizedå…³é”®å­—çš„æ—¶å€™ï¼Œèƒ½ç¼©å°ä»£ç æ®µçš„èŒƒå›´å°±å°½é‡ç¼©å°ï¼Œèƒ½åœ¨ä»£ç æ®µä¸ŠåŠ åŒæ­¥å°±ä¸è¦å†æ•´ä¸ªæ–¹æ³•ä¸ŠåŠ åŒæ­¥ã€‚è¿™å«å‡å°é”çš„ç²’åº¦ï¼Œä½¿ä»£ç æ›´å¤§ç¨‹åº¦çš„å¹¶å‘ã€‚åŸå› æ˜¯åŸºäºä»¥ä¸Šçš„æ€æƒ³ï¼Œé”çš„ä»£ç æ®µå¤ªé•¿äº†ï¼Œåˆ«çš„çº¿ç¨‹æ˜¯ä¸æ˜¯è¦ç­‰å¾ˆä¹…ï¼Œç­‰çš„èŠ±å„¿éƒ½è°¢äº†ã€‚å½“ç„¶è¿™æ®µæ˜¯é¢˜å¤–è¯ï¼Œä¸æœ¬æ–‡æ ¸å¿ƒæ€æƒ³å¹¶æ— å¤ªå¤§å…³è”ã€‚</p>
<h2 id="deadlocks-example">Deadlockâ€˜s example</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Alphonse and Gaston are friends, and great believers in courtesy. A strict rule of courtesy is that when you bow to a friend, you must remain bowed until your friend has a chance to return the bow. Unfortunately, this rule does not account for the possibility that two friends might bow to each other at the same time. This example application, Deadlock, models this possibility</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// When Deadlock runs, it&#x27;s extremely likely that both threads will block when they attempt to invoke bowBack. Neither block will ever end, because each thread is waiting for the other to exit bow.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Deadlock</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Friend</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Friend</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">bow</span><span class="params">(Friend bower)</span> </span>&#123;</span><br><span class="line">            System.out.format(<span class="string">&quot;%s: %s&quot;</span></span><br><span class="line">                + <span class="string">&quot;  has bowed to me!%n&quot;</span>, </span><br><span class="line">                <span class="keyword">this</span>.name, bower.getName());</span><br><span class="line">            bower.bowBack(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">bowBack</span><span class="params">(Friend bower)</span> </span>&#123;</span><br><span class="line">            System.out.format(<span class="string">&quot;%s: %s&quot;</span></span><br><span class="line">                + <span class="string">&quot; has bowed back to me!%n&quot;</span>,</span><br><span class="line">                <span class="keyword">this</span>.name, bower.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Friend alphonse =</span><br><span class="line">            <span class="keyword">new</span> Friend(<span class="string">&quot;Alphonse&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> Friend gaston =</span><br><span class="line">            <span class="keyword">new</span> Friend(<span class="string">&quot;Gaston&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; alphonse.bow(gaston); &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; gaston.bow(alphonse); &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="dining-philosophers-problem">Dining Philosophers Problem</h2>
<p>In this lecture, we studied a classical concurrent programming example that is referred to as the Dining Philosophers Problem. In this problem, there are five threads, each of which models a â€œphilosopherâ€ that repeatedly performs a sequence of actions which include think, pick up chopsticks, eat, and put down chopsticks.</p>
<p>First, we examined a solution to this problem using structured locks, and demonstrated how this solution could lead to a deadlock scenario (but not livelock). Second, we examined a solution using unstructured locks with ğšğš›ğš¢ğ™»ğš˜ğšŒğš”() and ğšğš—ğš•ğš˜ğšŒğš”() operations that never block, and demonstrated how this solution could lead to a livelock scenario (but not deadlock). Finally, we observed how a simple modification to the first solution with structured locks, in which one philosopher picks up their right chopstick and their left, while the others pick up their left chopstick first and then their right, can guarantee an absence of deadlock.</p>
<blockquote>
<hr />
<p>ä½œè€…ï¼šä¹èŒ¶ æ¥æºï¼šCSDN åŸæ–‡ï¼šhttps://blog.csdn.net/Bone_ACE/article/details/46362599 ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºåšä¸»åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·é™„ä¸Šåšæ–‡é“¾æ¥ï¼</p>
</blockquote>
<p>äº”ä¸ªå“²å­¦å®¶ï¼ˆA~Eï¼‰å›´ç€ä¸€å¼ åœ†æ¡Œå°±é¤ï¼Œä»–ä»¬æ¯ä¸ªäººé¢å‰éƒ½æœ‰ä¸€ç›˜é€šå¿ƒç²‰ã€‚ç”±äºé€šå¿ƒç²‰å¾ˆæ»‘ï¼Œæ‰€ä»¥éœ€è¦ä¸¤åªç­·å­æ‰èƒ½å¤¹ä½ï¼Œä½†æ¯ä¸¤ä¸ªç›˜å­ä¹‹é—´åªæ”¾ç€ä¸€åªç­·å­ï¼Œå¦‚ä¸‹å›¾ã€‚ å“²å­¦å®¶åªæœ‰ä¸¤ä¸ªåŠ¨ä½œï¼šè¦ä¹ˆå°±é¤ï¼Œè¦ä¹ˆæ€è€ƒã€‚è€Œä¸”ä»–ä»¬ä¹‹é—´ä»ä¸äº¤è°ˆã€‚ å½“ä¸€ä¸ªå“²å­¦å®¶é¥¿äº†çš„æ—¶å€™ï¼Œå°±æ‹¿èµ·ç›˜å­å·¦å³ä¸¤è¾¹çš„ç­·å­å¼€å§‹å°±é¤ï¼ˆä¸èƒ½åŒæ—¶æ‹¿èµ·ä¸¤åªç­·å­ï¼‰ã€‚å°±é¤å®Œä»¥åï¼Œå°±æŠŠç­·å­æ”¾å›ç›˜å­å·¦å³ï¼Œç»§ç»­æ€è€ƒã€‚</p>
<p><img src="1.png" /></p>
<p>ç”±äºä»–ä»¬ä¹‹é—´äº’ä¸äº¤è°ˆï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å‡ºç°â€œæ­»é”â€ï¼šå‡å¦‚æ¯ä¸ªäººéƒ½æ‹¿ç€å·¦è¾¹çš„ç­·å­ï¼Œåˆ™æ‰€æœ‰äººéƒ½åœ¨ç­‰å³è¾¹çš„ç­·å­ï¼Œè°éƒ½åƒä¸äº†ã€‚ æˆ‘ä»¬å¯ä»¥è§„å®šï¼Œæ‹¿ç€ä¸€åªç­·å­ç­‰å¾…å¦ä¸€åªç­·å­çš„æ—¶é—´è¶…è¿‡äº”åˆ†é’Ÿå°±æ”¾ä¸‹æ‰‹ä¸­çš„ç­·å­ï¼Œå¹¶ä¸”å†ç­‰å¾…äº”åˆ†é’Ÿä¹‹åè¿›è¡Œä¸‹ä¸€æ¬¡å°è¯•ã€‚ è¿™ä¸ªç­–ç•¥æ¶ˆé™¤äº†æ­»é”ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰å¯èƒ½å‘ç”Ÿâ€œæ´»é”â€ï¼šå‡å¦‚è¿™äº”ä¸ªäººåŒæ—¶æ‹¿èµ·å·¦è¾¹çš„ç­·å­ï¼Œå¤§å®¶éƒ½åœ¨ç­‰å¦ä¸€åªç­·å­ï¼Œäº”åˆ†é’Ÿä¹‹åå¤§å®¶åŒæ—¶æ”¾ä¸‹ç­·å­ã€‚å†è¿‡äº”åˆ†é’Ÿä¹‹ååˆåŒæ—¶æ‹¿èµ·å·¦è¾¹çš„ç­·å­â€¦â€¦</p>
<p>åœ¨è®¡ç®—æœºé¢†åŸŸä¸­ï¼Œå“²å­¦å®¶å°±é¤é—®é¢˜å¯ä»¥æŠ½è±¡æˆèµ„æºæŠ¢å é—®é¢˜ï¼Œç­·å­å°±æ˜¯â€œèµ„æºâ€ã€‚ä¸€ç§å¸¸ç”¨çš„è®¡ç®—æœºæŠ€æœ¯å°±æ˜¯ç»™èµ„æºâ€œåŠ é”â€ï¼Œä¸€ä¸ªèµ„æºåŒæ—¶åªèƒ½ä¾›ä¸€ä¸ªç¨‹åºæˆ–è€…ä¸€æ®µä»£ç è®¿é—®ã€‚å½“ä¸€ä¸ªç¨‹åºè¦ä½¿ç”¨çš„èµ„æºè¢«å¦å¤–ä¸€ä¸ªç¨‹åºé”å®šçš„æ—¶å€™ï¼Œåªèƒ½ç­‰å¾…èµ„æºè¢«è§£é”ã€‚è¿™å°±å®¹æ˜“å‡ºç°æ­»é”æƒ…å†µï¼Œå½“æœ‰ä¸¤ä¸ªç¨‹åºéœ€è¦è®¿é—®ä¸¤ä¸ªç›¸åŒçš„èµ„æºæ—¶ï¼Œå¦‚æœæ¯ä¸ªç¨‹åºéƒ½é”äº†ä¸€ä¸ªèµ„æºï¼Œé‚£ä¹ˆä¸¤è€…éƒ½åœ¨ç­‰å¾…å¯¹æ–¹è§£é”å¦ä¸€ä¸ªèµ„æºçš„è§£é”ï¼Œæœ€åè°éƒ½æ— æ³•æ‰§è¡Œã€‚</p>
<p>ä»¥ä¸‹ä»‹ç»ä¸‰ç§è§£å†³æ–¹æ¡ˆã€‚</p>
<ol type="1">
<li><p><strong>æœåŠ¡ç”Ÿ</strong>: å¯¹äºå°±é¤é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥ä¸€ä¸ªæœåŠ¡ç”Ÿï¼Œå“²å­¦å®¶è¦ç»è¿‡æœåŠ¡ç”ŸåŒæ„æ‰èƒ½æ‹¿ç­·å­ï¼Œå› ä¸ºæœåŠ¡ç”ŸçŸ¥é“å“ªåªç­·å­åœ¨ä½¿ç”¨ï¼Œä»–å¯ä»¥é˜»æ­¢æ­»é”çš„å‘ç”Ÿã€‚ è¿™å¾ˆå¥½ç†è§£ï¼Œåªæœ‰å½“ç›˜å­å·¦å³çš„ç­·å­éƒ½ç©ºé—²çš„æ—¶å€™ï¼ŒæœåŠ¡ç”Ÿæ‰ä¼šåŒæ„å“²å­¦å®¶å°±é¤ï¼Œè¿™æ ·å°±ä¸å­˜åœ¨æœ‰äººæ‹¿ç€ä¸€åªç­·å­åœ¨ç­‰å¾…å¦ä¸€åªç­·å­çš„æƒ…å†µï¼Œä¹Ÿå°±æœç»äº†æ­»é”çš„å‘ç”Ÿã€‚</p></li>
<li><p><strong>èµ„æºåˆ†çº§</strong>: å¦å¤–ä¸€ç§æ–¹æ³•å°±æ˜¯ç»™èµ„æºåˆ†çº§ï¼Œä¾‹å¦‚ä¸Šå›¾ä¸­çš„äº”åªç­·å­ï¼Œç»™å®ƒä»¬åˆ†çº§ä¸º1~5äº”ä¸ªç­‰çº§ã€‚ çº¦å®šï¼šæ¯ä½å“²å­¦å®¶åœ¨å°±é¤æ‹¿ç­·å­çš„æ—¶å€™ï¼Œåªèƒ½å…ˆæ‹¿çº§åˆ«æ¯”è¾ƒä½çš„ç­·å­ï¼Œç„¶åæ‰èƒ½æ‹¿çº§åˆ«æ¯”è¾ƒé«˜çš„ã€‚ç”¨é¤å®Œä»¥åï¼Œå…ˆæ”¾ä¸‹çº§åˆ«æ¯”è¾ƒé«˜çš„ç­·å­ï¼Œå†æ”¾ä¸‹ç¼–å·æ¯”è¾ƒä½çš„ã€‚è¿™æ ·ä¹Ÿä¸ä¼šå‡ºç°æ­»é”çš„æƒ…å†µã€‚å‡å¦‚å¤§å®¶åŒæ—¶æ‹¿èµ·ä¸€åªç­·å­ï¼Œé‚£ä¹ˆçº§åˆ«æœ€é«˜çš„5å·ç­·å­ä¸€å®šè¿˜ç•™åœ¨æ¡Œå­ä¸Šã€‚æ­¤æ—¶å“²å­¦å®¶Aæˆ–è€…Eå°±èƒ½æ‹¿èµ·å®ƒå‡‘æˆä¸¤åªç­·å­å¼€å§‹è¿›é¤ã€‚è¿›é¤å®Œä»¥åæ”¾ä¸‹ç­·å­ï¼Œå…¶ä»–å“²å­¦å®¶åˆèƒ½è¿›é¤äº†ã€‚ä½†æ˜¯ä»ç„¶æœ‰starvationçš„æƒ…å†µã€‚</p></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> edu.coursera.concurrent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Wrapper class for two lock-based concurrent list implementations.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CoarseLists</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * An implementation of the ListSet interface that uses Java locks to</span></span><br><span class="line"><span class="comment">     * protect against concurrent accesses.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * TODO Implement the add, remove, and contains methods below to support</span></span><br><span class="line"><span class="comment">     * correct, concurrent access to this list. Use a Java ReentrantLock object</span></span><br><span class="line"><span class="comment">     * to protect against those concurrent accesses. You may refer to</span></span><br><span class="line"><span class="comment">     * SyncList.java for help understanding the list management logic, and for</span></span><br><span class="line"><span class="comment">     * guidance in understanding where to place lock-based synchronization.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CoarseList</span> <span class="keyword">extends</span> <span class="title">ListSet</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * TODO Declare a lock for this class to be used in implementing the</span></span><br><span class="line"><span class="comment">         * concurrent add, remove, and contains methods below.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">         <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">new</span>  ReentrantLock();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Default constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">CoarseList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * TODO Use a lock to protect against concurrent access.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(<span class="keyword">final</span> Integer object)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                lock.lock();</span><br><span class="line">                Entry pred = <span class="keyword">this</span>.head;</span><br><span class="line">                Entry curr = pred.next;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (curr.object.compareTo(object) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    pred = curr;</span><br><span class="line">                    curr = curr.next;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (object.equals(curr.object)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">final</span> Entry entry = <span class="keyword">new</span> Entry(object);</span><br><span class="line">                    entry.next = curr;</span><br><span class="line">                    pred.next = entry;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * TODO Use a lock to protect against concurrent access.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(<span class="keyword">final</span> Integer object)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                lock.lock();</span><br><span class="line">                Entry pred = <span class="keyword">this</span>.head;</span><br><span class="line">                Entry curr = pred.next;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (curr.object.compareTo(object) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    pred = curr;</span><br><span class="line">                    curr = curr.next;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (object.equals(curr.object)) &#123;</span><br><span class="line">                    pred.next = curr.next;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * TODO Use a lock to protect against concurrent access.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(<span class="keyword">final</span> Integer object)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                lock.lock();</span><br><span class="line">                Entry pred = <span class="keyword">this</span>.head;</span><br><span class="line">                Entry curr = pred.next;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (curr.object.compareTo(object) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    pred = curr;</span><br><span class="line">                    curr = curr.next;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> object.equals(curr.object);</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * An implementation of the ListSet interface that uses Java read-write</span></span><br><span class="line"><span class="comment">     * locks to protect against concurrent accesses.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * TODO Implement the add, remove, and contains methods below to support</span></span><br><span class="line"><span class="comment">     * correct, concurrent access to this list. Use a Java</span></span><br><span class="line"><span class="comment">     * ReentrantReadWriteLock object to protect against those concurrent</span></span><br><span class="line"><span class="comment">     * accesses. You may refer to SyncList.java for help understanding the list</span></span><br><span class="line"><span class="comment">     * management logic, and for guidance in understanding where to place</span></span><br><span class="line"><span class="comment">     * lock-based synchronization.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RWCoarseList</span> <span class="keyword">extends</span> <span class="title">ListSet</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * TODO Declare a read-write lock for this class to be used in</span></span><br><span class="line"><span class="comment">         * implementing the concurrent add, remove, and contains methods below.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> ReentrantReadWriteLock readWriteLock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Default constructor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">RWCoarseList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * TODO Use a read-write lock to protect against concurrent access.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(<span class="keyword">final</span> Integer object)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                readWriteLock.writeLock().lock();</span><br><span class="line">                Entry pred = <span class="keyword">this</span>.head;</span><br><span class="line">                Entry curr = pred.next;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (curr.object.compareTo(object) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    pred = curr;</span><br><span class="line">                    curr = curr.next;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (object.equals(curr.object)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">final</span> Entry entry = <span class="keyword">new</span> Entry(object);</span><br><span class="line">                    entry.next = curr;</span><br><span class="line">                    pred.next = entry;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                readWriteLock.writeLock().unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * TODO Use a read-write lock to protect against concurrent access.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(<span class="keyword">final</span> Integer object)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                readWriteLock.writeLock().lock();</span><br><span class="line">                Entry pred = <span class="keyword">this</span>.head;</span><br><span class="line">                Entry curr = pred.next;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (curr.object.compareTo(object) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    pred = curr;</span><br><span class="line">                    curr = curr.next;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (object.equals(curr.object)) &#123;</span><br><span class="line">                    pred.next = curr.next;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                readWriteLock.writeLock().unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * TODO Use a read-write lock to protect against concurrent access.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(<span class="keyword">final</span> Integer object)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                readWriteLock.readLock().lock();</span><br><span class="line">                Entry pred = <span class="keyword">this</span>.head;</span><br><span class="line">                Entry curr = pred.next;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">while</span> (curr.object.compareTo(object) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    pred = curr;</span><br><span class="line">                    curr = curr.next;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> object.equals(curr.object);</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                readWriteLock.readLock().unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java/" rel="tag"># Java</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Data-Flow-Synchronization-and-Pipelining/2019/06/13/" rel="prev" title="Data Flow Synchronization and Pipelining">
      <i class="fa fa-chevron-left"></i> Data Flow Synchronization and Pipelining
    </a></div>
      <div class="post-nav-item">
    <a href="/Critical-Sections-and-Isolation/2019/06/21/" rel="next" title="Critical Sections and Isolation">
      Critical Sections and Isolation <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#table-of-contents"><span class="nav-number">1.</span> <span class="nav-text">Table of Contents</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#threads"><span class="nav-number">1.1.</span> <span class="nav-text">Threads</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#structured-locks"><span class="nav-number">1.2.</span> <span class="nav-text">Structured Locks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#unstructured-locks"><span class="nav-number">1.3.</span> <span class="nav-text">Unstructured Locks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#liveness-and-progress-guarantees"><span class="nav-number">1.4.</span> <span class="nav-text">Liveness and Progress Guarantees</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#synchronized-%E7%94%A8%E6%B3%95"><span class="nav-number">1.4.1.</span> <span class="nav-text">synchronized ç”¨æ³•</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#deadlocks-example"><span class="nav-number">1.5.</span> <span class="nav-text">Deadlockâ€˜s example</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dining-philosophers-problem"><span class="nav-number">1.6.</span> <span class="nav-text">Dining Philosophers Problem</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ruochi Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">224</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">46</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhangruochi" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;zhangruochi" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zrc720@gmail.com" title="E-Mail â†’ mailto:zrc720@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.healthinformaticslab.org/" title="http:&#x2F;&#x2F;www.healthinformaticslab.org" rel="noopener" target="_blank">HILab</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.shihaizhou.com/" title="http:&#x2F;&#x2F;www.shihaizhou.com" rel="noopener" target="_blank">Rose</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/cherish_CX/" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;cherish_CX&#x2F;" rel="noopener" target="_blank">Chunxia</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 â€“ 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ruochi Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'qW3MLcAgcX96sB6qbegeL7rP-gzGzoHsz',
      appKey     : 'GL6JvT9DgGxqYrY5Vj6bXVuv',
      placeholder: "Thank you for your reply",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
